name: Relat칩rio Di치rio (Screenshot)

on:
  
  #schedule:
    # 21:00 BRT = 00:00 UTC (Executa para o dia ATUAL - Noite)
   # - cron: '0 0 * * *'
    
    # 07:15 BRT = 10:15 UTC (Executa para o dia ANTERIOR - Manh칚)
   # - cron: '15 10 * * *'
    
  workflow_dispatch:
    inputs:
      mode:
        description: 'Modo de Data (auto, today, yesterday)'
        required: false
        default: 'auto'
        type: choice
        options:
          - auto
          - today
          - yesterday
      test_email:
        description: 'Email de Teste (Opcional)'
        required: false
        type: string

jobs:
  take-screenshot:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout do c칩digo
      uses: actions/checkout@v4

    - name: Configurar Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'

    - name: Instalar Depend칡ncias e Playwright
      run: |
        pip install -r automation/requirements.txt
        playwright install --with-deps chromium

    - name: Rodar Bot de Screenshot
      env:
        DASHBOARD_URL: ${{ secrets.DASHBOARD_URL }}
        POWER_AUTOMATE_URL: ${{ secrets.POWER_AUTOMATE_URL }}
        RECIPIENT_EMAIL: ${{ secrets.RECIPIENT_EMAIL }}
        MODE: ${{ inputs.mode || 'auto' }}
        BOT_BYPASS_KEY: ${{ secrets.BOT_BYPASS_KEY }} 
      run: |
        CMD="python automation/bot.py"
        
        if [ -n "${{ inputs.test_email }}" ]; then
          echo "游빍 Modo de Teste Ativado: Enviando para ${{ inputs.test_email }}"
          CMD="$CMD --email ${{ inputs.test_email }}"
        else
          echo "游닎 Modo Padr칚o: Enviando para destinat치rio oficial."
        fi
        
        $CMD
        
    - name: Upload do Screenshot (Artifact)
      uses: actions/upload-artifact@v4
      if: always()
      with:
        name: relatorio-status
        path: automation/screenshot.png
        retention-days: 5